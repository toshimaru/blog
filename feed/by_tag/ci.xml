<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.0">Jekyll</generator><link href="https://blog.toshima.ru/feed/by_tag/ci.xml" rel="self" type="application/atom+xml" /><link href="https://blog.toshima.ru/" rel="alternate" type="text/html" /><updated>2021-04-04T16:42:42+09:00</updated><id>https://blog.toshima.ru/feed/by_tag/ci.xml</id><title type="html">Toshimaru’s Blog</title><subtitle>Where there&apos;s a will, there&apos;s a way.
</subtitle><author><name>toshimaru</name></author><entry><title type="html">How to fix “This version of ChromeDriver only supports Chrome version xx” on Ubuntu</title><link href="https://blog.toshima.ru/2019/12/20/fix-chromedriver-only-supports-chrome-version.html" rel="alternate" type="text/html" title="How to fix “This version of ChromeDriver only supports Chrome version xx” on Ubuntu" /><published>2019-12-20T00:00:00+09:00</published><updated>2020-06-04T00:00:00+09:00</updated><id>https://blog.toshima.ru/2019/12/20/fix-chromedriver-only-supports-chrome-version</id><content type="html" xml:base="https://blog.toshima.ru/2019/12/20/fix-chromedriver-only-supports-chrome-version.html">&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#issue&quot; id=&quot;markdown-toc-issue&quot;&gt;Issue&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#solution-1-install-latest-chrome&quot; id=&quot;markdown-toc-solution-1-install-latest-chrome&quot;&gt;Solution 1: Install latest Chrome&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#solution-remove-outdated-chrome&quot; id=&quot;markdown-toc-solution-remove-outdated-chrome&quot;&gt;Solution: Remove outdated Chrome&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#see-also&quot; id=&quot;markdown-toc-see-also&quot;&gt;See also&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;issue&quot;&gt;Issue&lt;/h2&gt;

&lt;p&gt;When I was running CI on &lt;a href=&quot;https://github.com/features/actions&quot;&gt;GitHub Actions&lt;/a&gt;, CI for Ubuntu suddenly gets an error.&lt;/p&gt;

&lt;p&gt;The error says:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Failures:

  1) ...
     Got 0 failures and 2 other errors:

     1.1) Failure/Error: visit login_path

          Selenium::WebDriver::Error::SessionNotCreatedError:
            session not created: This version of ChromeDriver only supports Chrome version 79

     1.2) Failure/Error: Unable to infer file and line number from backtrace

          Selenium::WebDriver::Error::SessionNotCreatedError:
            session not created: This version of ChromeDriver only supports Chrome version 79
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The error message is:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Selenium::WebDriver::Error::SessionNotCreatedError:
  session not created: This version of ChromeDriver only supports Chrome version 79
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;solution-1-install-latest-chrome&quot;&gt;Solution 1: Install latest Chrome&lt;/h2&gt;

&lt;p&gt;The error message basically says “your Chrome version is outdated”, so install the latest chrome with chromedriver.&lt;/p&gt;

&lt;div class=&quot;language-diff highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gd&quot;&gt;- sudo apt-get install libsqlite3-dev chromium-driver
&lt;/span&gt;&lt;span class=&quot;gi&quot;&gt;+ sudo apt-get update
+ sudo apt-get install libsqlite3-dev chromium-driver google-chrome-stable
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;solution-remove-outdated-chrome&quot;&gt;Solution: Remove outdated Chrome&lt;/h2&gt;

&lt;p&gt;Another solution is removing outdated Google Chrome (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;google-chrome-stable&lt;/code&gt;) on the machine. By doing so, CI uses chromium instead of google-chrome as the browser.&lt;/p&gt;

&lt;div class=&quot;language-diff highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gi&quot;&gt;+ sudo apt-get remove google-chrome-stable
&lt;/span&gt;  sudo apt-get install libsqlite3-dev chromium-driver
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;see-also&quot;&gt;See also&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;Pull Request examples
    &lt;ul&gt;
      &lt;li&gt;Solution 1: &lt;a href=&quot;https://github.com/toshimaru/RailsTwitterClone/pull/619&quot;&gt;Bump faker from 2.8.1 to 2.9.0&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;Solution 2: &lt;a href=&quot;https://github.com/toshimaru/RailsTwitterClone/pull/625&quot;&gt;Use chromium-browser instead of google-chrome-stable&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.omgubuntu.co.uk/2019/08/install-chromium-browser-ubuntu&quot;&gt;Install Chromium on Ubuntu 18.04 LTS &amp;amp; Linux Mint&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>toshimaru</name></author><category term="ci" /><category term="chrome" /><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshima.ru/android-chrome-512x512.png" /><media:content medium="image" url="https://blog.toshima.ru/android-chrome-512x512.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Enable Go Module Cache on TravisCI</title><link href="https://blog.toshima.ru/2019/08/08/enable-go-module-cache-on-travisci.html" rel="alternate" type="text/html" title="Enable Go Module Cache on TravisCI" /><published>2019-08-08T00:00:00+09:00</published><updated>2019-08-08T00:00:00+09:00</updated><id>https://blog.toshima.ru/2019/08/08/enable-go-module-cache-on-travisci</id><content type="html" xml:base="https://blog.toshima.ru/2019/08/08/enable-go-module-cache-on-travisci.html">&lt;p&gt;&lt;amp-img src=&quot;/images/go-mod-cache.png&quot; alt=&quot;Go Mod Cache before/after&quot; width=&apos;1636&apos; height=&apos;338&apos; layout=&apos;responsive&apos;&gt;&lt;/amp-img&gt;&lt;/p&gt;

&lt;h2 id=&quot;enbale-go-module-cache-on-travisci&quot;&gt;Enbale Go Module Cache on TravisCI&lt;/h2&gt;

&lt;p&gt;To enbale Go module cache, set &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$GOPATH/pkg/mod&lt;/code&gt; as TravisCI cache directory.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.travis.yml&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;cache&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;directories&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;$GOPATH/pkg/mod&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;whole-travisyml-sample&quot;&gt;Whole &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.travis.yml&lt;/code&gt; Sample&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.travis.yml&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;language&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;go&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;go&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;1.12.x&quot;&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;cache&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;directories&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;$GOPATH/pkg/mod&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;global&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;GO111MODULE=on&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;install&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;go mod download&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;script&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;go test ./...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/coredns/coredns/pull/2686/files&quot;&gt;Add &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$GOPATH/pkg/mod&lt;/code&gt; to Travis CI cache by yongtang · Pull Request #2686 · coredns/coredns&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>toshimaru</name></author><category term="go" /><category term="ci" /><summary type="html"></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshima.ru/android-chrome-512x512.png" /><media:content medium="image" url="https://blog.toshima.ru/android-chrome-512x512.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">CircleCI 2 speeds up your CI build time drastically</title><link href="https://blog.toshima.ru/2017/08/18/circleci2-speeds-up-your-ci-time.html" rel="alternate" type="text/html" title="CircleCI 2 speeds up your CI build time drastically" /><published>2017-08-18T00:00:00+09:00</published><updated>2017-08-18T00:00:00+09:00</updated><id>https://blog.toshima.ru/2017/08/18/circleci2-speeds-up-your-ci-time</id><content type="html" xml:base="https://blog.toshima.ru/2017/08/18/circleci2-speeds-up-your-ci-time.html">&lt;p&gt;&lt;a href=&quot;https://circleci.com/blog/launching-today-circleci-2-0-reaches-general-availability/&quot;&gt;CircleCI 2 has been released&lt;/a&gt;, which makes your CI faster and flexible.&lt;/p&gt;

&lt;p&gt;I’ve accomplished 3 times faster CI build time on &lt;a href=&quot;https://github.com/toshimaru/RailsTwitterClone&quot;&gt;my public project&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;amp-img src=&quot;/images/circleci2.png&quot; alt=&quot;faster build time&quot; width=&apos;1702&apos; height=&apos;996&apos; layout=&apos;responsive&apos;&gt;&lt;/amp-img&gt;&lt;/p&gt;

&lt;p&gt;Here is how I configured my &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;circle.yml&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id=&quot;before-circle-10-configuration&quot;&gt;Before: Circle 1.0 configuration&lt;/h2&gt;

&lt;p&gt;Circle 1.0 configuration is very simple.&lt;/p&gt;

&lt;div class=&quot;language-yml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# circle.yml&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;machine&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;ruby&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;2.4.1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;general&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;artifacts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;coverage&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;tmp/capybara&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;after-circle-20-configuration&quot;&gt;After: Circle 2.0 configuration&lt;/h2&gt;

&lt;p&gt;Circle 2.0 configuration becomes a bit overwhelming, but I’ll explain it one by one.&lt;/p&gt;

&lt;div class=&quot;language-yml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# .circleci/config.yml&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;working_directory&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;~/app&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;circleci/ruby:2.5-node-browsers&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;RAILS_ENV&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;test&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;checkout&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;# Restore bundle cache&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;cache-restore&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;bundle-{{ checksum &quot;Gemfile.lock&quot; }}&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;# Bundle install dependencies&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;bundle install --path vendor/bundle&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;# Store bundle cache&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;cache-save&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;bundle-{{ checksum &quot;Gemfile.lock&quot; }}&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;vendor/bundle&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;# Database setup&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;bundle exec rails db:create db:schema:load&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;# RSpec&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;bundle exec rspec&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;store_artifacts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;coverage&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;store_artifacts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;tmp/capybara&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;working-directory&quot;&gt;Working Directory&lt;/h3&gt;

&lt;p&gt;First of all, set your &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;working_directory&lt;/code&gt;, any name is okay.&lt;/p&gt;

&lt;div class=&quot;language-yml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;working_directory&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;~/app&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;docker-image&quot;&gt;docker image&lt;/h3&gt;

&lt;p&gt;Then, you need to specify base docker image on CircleCI 2. In this case, I used CircleCI official docker image listed &lt;a href=&quot;https://hub.docker.com/r/circleci/ruby/tags/&quot;&gt;here&lt;/a&gt;(All available images are listed &lt;a href=&quot;https://hub.docker.com/u/circleci/&quot;&gt;here&lt;/a&gt;).&lt;/p&gt;

&lt;div class=&quot;language-yml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;circleci/ruby:2.5-node-browsers&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;RAILS_ENV&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;test&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;environment&lt;/code&gt; section, I configured environment variables for the base image.&lt;/p&gt;

&lt;h3 id=&quot;repository-checkout&quot;&gt;Repository checkout&lt;/h3&gt;

&lt;p&gt;This line means checkout your code base from the repository.&lt;/p&gt;

&lt;div class=&quot;language-yml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;checkout&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;bundle-cache-configuration&quot;&gt;Bundle cache configuration&lt;/h3&gt;

&lt;p&gt;As of CircleCI 2, you need to configured cache setting by yourself. In my Rails project, bundler is used, so I configured bundle install cache as the following.&lt;/p&gt;

&lt;div class=&quot;language-yml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# Restore bundle cache&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;cache-restore&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;bundle-{{ checksum &quot;Gemfile.lock&quot; }}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# Bundle install dependencies&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;bundle install --path vendor/bundle&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# Store bundle cache&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;cache-save&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;bundle-{{ checksum &quot;Gemfile.lock&quot; }}&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;vendor/bundle&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;rails-testing&quot;&gt;Rails testing&lt;/h3&gt;

&lt;p&gt;Rails database setup and runnning RSpec:&lt;/p&gt;

&lt;div class=&quot;language-yml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# Database setup&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;bundle exec rails db:create db:schema:load&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# RSpec&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;bundle exec rspec&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;phantomjs&quot;&gt;PhantomJS&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;Update: If you use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;circleci/ruby:2.5-node-browsers&lt;/code&gt; docker image, PhantomJS is bundled in the image. Therefore, you don’t have to follow the following step.&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;del&gt;I used &lt;a href=&quot;https://github.com/teampoltergeist/poltergeist&quot;&gt;poltergeist&lt;/a&gt; as a Capybara javascript driver. It requires PhantomJS as a dependency but official Ruby docker image doesn’t include PhantomJS, so I needed to install PhantomJS by myself.&lt;/del&gt;&lt;/p&gt;

&lt;div class=&quot;language-yml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Install PhantomJS&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;|&lt;/span&gt;
      &lt;span class=&quot;s&quot;&gt;mkdir -p ~/.phantomjs/${PHANTOM_JS_VERSION}&lt;/span&gt;
      &lt;span class=&quot;s&quot;&gt;curl -L --output ~/.phantomjs/${PHANTOM_JS_VERSION}/phantomjs.tar.bz2 https://bitbucket.org/ariya/phantomjs/downloads/phantomjs-${PHANTOM_JS_VERSION}-linux-x86_64.tar.bz2&lt;/span&gt;
      &lt;span class=&quot;s&quot;&gt;tar xfvj ~/.phantomjs/${PHANTOM_JS_VERSION}/phantomjs.tar.bz2 -C ~/.phantomjs/${PHANTOM_JS_VERSION}/&lt;/span&gt;
      &lt;span class=&quot;s&quot;&gt;chmod ugo+x ~/.phantomjs/${PHANTOM_JS_VERSION}/phantomjs-${PHANTOM_JS_VERSION}-linux-x86_64/bin/phantomjs&lt;/span&gt;
      &lt;span class=&quot;s&quot;&gt;sudo ln -sf ~/.phantomjs/${PHANTOM_JS_VERSION}/phantomjs-${PHANTOM_JS_VERSION}-linux-x86_64/bin/phantomjs /usr/local/bin/phantomjs&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;del&gt;I created environment variable of PhantomJS version(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PHANTOM_JS_VERSION&lt;/code&gt;) so that we can upgrade PhantomJS version easily.&lt;/del&gt;&lt;/p&gt;

&lt;h3 id=&quot;artifacts&quot;&gt;Artifacts&lt;/h3&gt;

&lt;p&gt;You can upload artifacts by specifying &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_artifacts&lt;/code&gt; and the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;path&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-yml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;store_artifacts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;coverage&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;store_artifacts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;tmp/capybara&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;comparison&quot;&gt;Comparison&lt;/h2&gt;

&lt;p&gt;&lt;amp-img src=&quot;/images/circleci2-2.png&quot; alt=&quot;circleci 1 to 2&quot; width=&apos;1400&apos; height=&apos;274&apos; layout=&apos;responsive&apos;&gt;&lt;/amp-img&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;CircleCI 1.0 Phase&lt;/th&gt;
      &lt;th&gt;&lt;a href=&quot;https://circleci.com/gh/toshimaru/RailsTwitterClone/197&quot;&gt;CircleCI 1.0&lt;/a&gt;&lt;/th&gt;
      &lt;th&gt;&lt;a href=&quot;https://circleci.com/gh/toshimaru/RailsTwitterClone/264&quot;&gt;CircleCI 2.0&lt;/a&gt;&lt;/th&gt;
      &lt;th&gt;improvement&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;INFRASTRUCTURE&lt;/td&gt;
      &lt;td&gt;25 sec&lt;/td&gt;
      &lt;td&gt;1 sec&lt;/td&gt;
      &lt;td&gt;&lt;strong class=&quot;green&quot;&gt;25x faster&lt;/strong&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;CHECKOUT&lt;/td&gt;
      &lt;td&gt;10 sec&lt;/td&gt;
      &lt;td&gt;1 sec&lt;/td&gt;
      &lt;td&gt;&lt;strong class=&quot;green&quot;&gt;10x faster&lt;/strong&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;MACHINE(cache restore)&lt;/td&gt;
      &lt;td&gt;15 sec&lt;/td&gt;
      &lt;td&gt;3 sec&lt;/td&gt;
      &lt;td&gt;&lt;strong class=&quot;green&quot;&gt;5x faster&lt;/strong&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;DEPENDENCIES(bundle install)&lt;/td&gt;
      &lt;td&gt;6 sec&lt;/td&gt;
      &lt;td&gt;1 sec&lt;/td&gt;
      &lt;td&gt;&lt;strong class=&quot;green&quot;&gt;6x faster&lt;/strong&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;DATABASE&lt;/td&gt;
      &lt;td&gt;11 sec&lt;/td&gt;
      &lt;td&gt;6 sec&lt;/td&gt;
      &lt;td&gt;&lt;strong class=&quot;green&quot;&gt;2x faseter&lt;/strong&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;TEST(RSpec)&lt;/td&gt;
      &lt;td&gt;20 sec&lt;/td&gt;
      &lt;td&gt;22 sec&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;TEARDOWN(artifacts)&lt;/td&gt;
      &lt;td&gt;26 sec&lt;/td&gt;
      &lt;td&gt;1 sec&lt;/td&gt;
      &lt;td&gt;&lt;strong class=&quot;green&quot;&gt;26x fasetr&lt;/strong&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;Total build time on CircleCI&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;&lt;strong&gt;02:02&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;&lt;strong&gt;00:40&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;&lt;strong class=&quot;green&quot;&gt;3x faster&lt;/strong&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;* 0 sec is rounded to 1 sec&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;CircleCI 2.0 is much faster than CircleCI 1.0. Although CircleCI 2 configuration looks complex, it gives you flexibility and better CI experience. It’ll be worth it.&lt;/p&gt;

&lt;h2 id=&quot;resources&quot;&gt;Resources&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/toshimaru/RailsTwitterClone/pull/80&quot;&gt;CircleCI 2 by toshimaru · Pull Request #80 · toshimaru/RailsTwitterClone&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://circleci.com/gh/toshimaru/RailsTwitterClone/tree/master&quot;&gt;CircleCI: master branch CI build time&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/toshimaru/RailsTwitterClone/blob/master/.circleci/config.yml&quot;&gt;My latest config.yml for CircleCI&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://circleci.com/docs/2.0/&quot;&gt;2.0 Docs - CircleCI&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>toshimaru</name></author><category term="circleci" /><category term="ci" /><summary type="html">CircleCI 2 has been released, which makes your CI faster and flexible.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshima.ru/android-chrome-512x512.png" /><media:content medium="image" url="https://blog.toshima.ru/android-chrome-512x512.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Installing MySQL 5.7 on CircleCI</title><link href="https://blog.toshima.ru/2016/06/15/mysql-5-7-on-circle-ci.html" rel="alternate" type="text/html" title="Installing MySQL 5.7 on CircleCI" /><published>2016-06-15T00:00:00+09:00</published><updated>2016-06-15T00:00:00+09:00</updated><id>https://blog.toshima.ru/2016/06/15/mysql-5-7-on-circle-ci</id><content type="html" xml:base="https://blog.toshima.ru/2016/06/15/mysql-5-7-on-circle-ci.html">&lt;h2 id=&quot;update-2&quot;&gt;[UPDATE 2]&lt;/h2&gt;

&lt;p&gt;Current best approach is changing CircleCI &lt;strong&gt;Build Environment&lt;/strong&gt; to the latest version which is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ubuntu 14.04&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://circleci.com/docs/build-image-trusty/&quot;&gt;Ubuntu 14.04 (Trusty) - CircleCI&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This build image has MySQL 5.7.x by default.&lt;/p&gt;

&lt;h2 id=&quot;update&quot;&gt;[UPDATE]&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://s3.amazonaws.com/circle-downloads/install-mysql5.7-circleci.sh&quot;&gt;Original script&lt;/a&gt; currently doesn’t work because it refers to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mysql-5.7-dmr&lt;/code&gt;&lt;sup id=&quot;fnref:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt; which is outdated.&lt;/p&gt;

&lt;p&gt;Please use &lt;a href=&quot;https://gist.github.com/toshimaru/06ffbf2e8ad7d4e3dab889fa27681835/&quot;&gt;my forked script&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The raw source is: &lt;a href=&quot;https://gist.githubusercontent.com/toshimaru/06ffbf2e8ad7d4e3dab889fa27681835/raw/install-mysql5.7-circleci.sh&quot;&gt;https://gist.githubusercontent.com/toshimaru/06ffbf2e8ad7d4e3dab889fa27681835/raw/install-mysql5.7-circleci.sh&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;CircleCI doesn’t support MySQL 5.7 by default.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://discuss.circleci.com/users/kimh/activity&quot;&gt;kimh&lt;/a&gt;, CircleCI employee, created a script to install MySQL 5.7 on CircleCI.&lt;/p&gt;

&lt;p&gt;To use this script, add below configuration to your &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;circle.yml&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-yml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;dependencies&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;pre&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;curl -sSL https://gist.githubusercontent.com/toshimaru/06ffbf2e8ad7d4e3dab889fa27681835/raw/install-mysql5.7-circleci.sh | sh&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The output on CircleCI is:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(snip)
..
* MySQL Community Server 5.7.14 is started
Setting up mysql-server (5.7.14-1ubuntu12.04) ...
Setting up libmysqlclient20 (5.7.14-1ubuntu12.04) ...
Setting up libmysqlclient-dev (5.7.14-1ubuntu12.04) ...
Processing triggers for libc-bin ...
ldconfig deferred processing now taking place
+ echo Checking installed version.....
Checking installed version.....
+ mysql -D mysql -e SELECT version()
version()
5.7.14
+ echo Done!!
Done!!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then, you can use MySQL 5.7 on CircleCI container.&lt;/p&gt;

&lt;h2 id=&quot;see-also&quot;&gt;See also&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://discuss.circleci.com/t/installing-mysql-5-7/1021&quot;&gt;Installing MySQL 5.7 - Build Environment - CircleCI Community Discussion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;DMR means development milestone release. ref. &lt;a href=&quot;https://dev.mysql.com/doc/mysql-development-cycle/en/development-milestone-releases.html&quot;&gt;MySQL :: MySQL Development Cycle :: 6 Development Milestone Releases&lt;/a&gt; &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;</content><author><name>toshimaru</name></author><category term="circleci" /><category term="mysql" /><category term="ci" /><summary type="html">[UPDATE 2]</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshima.ru/android-chrome-512x512.png" /><media:content medium="image" url="https://blog.toshima.ru/android-chrome-512x512.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry></feed>